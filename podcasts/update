require 'yaml'
require 'rss/1.0'
require 'rss/2.0'
require 'open-uri'
require 'pp'

def main
  load_cache
  YAML.load_file('feeds.list').each {|f| update_feed(f)}
  save_cache
end

def update_feed(feed)
  rss = download_rss(feed[:url])
  rss.items.each {|i| update_episode(i)}
end

def update_episode(item)
  p item.title
end

def download_rss(url)
  RSS::Parser.parse(get(url), false).channel
end
  
def some_other_code
  Dir.mkdir(name) unless test(?d, name)
  Dir.chdir(name) do
    episodes = test(?f, '.episodes') ? YAML.load_file('.episodes') : {}
    open('.episodes','w') {|out| YAML.dump episodes, out}
  end
end

def get(url)
  return $cache[url] if $cache.has_key? url
  print "downloading: #{url}\n"
  $cache[url] = open(url).read 
end

def load_cache(file='.cache')
  $cache = test(?f, file) ? Marshal.load(open(file,'r').read) : Hash.new
end

def save_cache(file='.cache')
  open(file,'w') {|f| f << Marshal.dump($cache)}
end

main